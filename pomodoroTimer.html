<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pomodoro Timer</title>
  <style>
    body {
      display: flex;
      /* justify-content: center; */
      align-items: center;
      width: 100vw;
      height: 100vh;
    }
    .wrapper {
      display: flex;
      justify-content: center;
      align-items: center;
      width: 100vw;
      height: 100vh;
    }
    .workTimer,
    .relaxTimer {
      /* display: flex;
      justify-content: center;
      align-items: center; */
      width: 40%;
      font-size: 50px;
    }
    .countdown {
      display: flex;
      justify-content: center;
      align-items: center;
      margin-bottom: 50px;
    }
    .btnContainer {
      display: flex;
      flex-direction: column;
      /* justify-content: center; */
      align-items: center;

      width: 100%;
      max-width: 250px;
    }
    button {
      cursor: pointer;
      font-size: large;
    }
    .main {
      margin-bottom: 20px;
      width: 50%;
      aspect-ratio: 1 / 1;
      border-radius: 50%;
      border: 1px solid pink;
    }
    .resetBtn {
      width: 25%;
      height: 100%;
    }
  </style>
</head>
<body>
  <div class="wrapper">
    <div class="workTimer">
      <div class="countdown" id="c1">
        <div class="min">00</div>
        <span>:</span>
        <div class="sec">01</div>
      </div>
      <div class="btnContainer">
        <button class="main">start</button>
        <button class="resetBtn">reset</button>
      </div>
    </div>
    <div class="relaxTimer">
      <div class="countdown" id="c2">
        <div class="min">15</div>
        <span>:</span>
        <div class="sec">00</div>
      </div>
      <div class="btnContainer">
        <button class="main">start</button>
        <button class="resetBtn">reset</button>
      </div>
    </div>
  </div>

  <script>
    function highlightText(element) {
      const range = document.createRange()
      //select all the content inside the element vv
      range.selectNodeContents(element)
      const selection = window.getSelection()
      // remove existing selections
      selection.removeAllRanges()
      selection.addRange(range)
    }

    // number: 1 to the next section, -1 to the previous
    function switchEnterSection(nodeList, index, number) {
      const whereTo = nodeList[index + number]
      whereTo.contentEditable = 'true'
      whereTo.focus()
      highlightText(whereTo)
    }

    const workTimer = document.querySelectorAll('.countdown div')
    let timerRecord = []
    // vv get the min and sec of alarms and store them to the timerRecord array
    workTimer.forEach((timer, index) => {
      timerRecord[index] = timer.innerHTML
    })
    
    // editable timer
    workTimer.forEach((timer, index) => {
      timer.addEventListener('click', () => {
        timer.contentEditable = 'true'
        timer.focus()
        highlightText(timer)
      })
      // when use press "tab" key in editing, switch to the next div
      timer.addEventListener('keydown', (e) => {
        if (e.key === 'Tab' && timer.contentEditable) {
          e.preventDefault()

          if (index < 3) {
            switchEnterSection(workTimer, index, 1)
          }
        }
      })
      // when use a combination of "shift + tab" is pressed in editing, switch to the previous div
      timer.addEventListener('keydown', (e) => {
        if (e.key === 'Tab' && e.shiftKey) {
          e.preventDefault()
          console.log(index)
          
          if (index > 0) {
            switchEnterSection(workTimer, index, -1)
          }
        }
      })
      timer.addEventListener('blur', () => {
        timer.contentEditable = 'false'
      })
      //limit the input to 2 digits
      timer.addEventListener('input', () => {
        // anything besides digits will be omit
        let digitOnly = timer.textContent.replace(/[^\d]/g,'')
        timer.textContent = digitOnly
        // switch to the next editing section after the second digit is entered. when index === 3, cut the third digit
        if (digitOnly.length >= 2) {
          if (index === 3) {
            timer.textContent = timer.textContent.slice(0, 2)
            highlightText(timer)
            timerRecord[index] = timer.textContent
            console.log(timerRecord)
            return
          }
          timerRecord[index] = timer.textContent
          switchEnterSection(workTimer, index, 1)
          console.log(timerRecord)
        }
      })
    })

    // start|pause timer
    const mainBtns = document.querySelectorAll('.main')
    const resetBtns = document.querySelectorAll('.resetBtn')
    let isPause = true
    let timerID
    
    // when the button is hit, and the timer is not running(isPause=true), get the current display number and start counting down; otherwise reverse the flag and stop the counter
    mainBtns.forEach((btn, index) => {
      btn.addEventListener('click', () => {
        if (isPause) {
          btn.innerHTML = 'pause'
          const displayMin = document.querySelector(`#c${index + 1} .min`)
          const displaySec = document.querySelector(`#c${index + 1} .sec`)
          const [min, sec] = [
            displayMin.innerHTML,
            displaySec.innerHTML
          ].map(Number)
          let totalSec = min * 60 + sec
          timerID = setInterval(() => {
            if (totalSec > 0) {
              isPause = false
              totalSec--
              const newMin = String(Math.floor(totalSec / 60)).padStart(2, '0')
              const newSec = String(totalSec % 60).padStart(2, '0')
              displayMin.innerHTML = `${newMin}`
              displaySec.innerHTML = `${newSec}`
            } else {
              alert('Time is up!')
              clearInterval(timerID)
              isPause = true
              btn.innerHTML = 'start'
            }
          }, 1000)
        } else {
          clearInterval(timerID)
          isPause = true
        }
      })
    })

    //reset button
    resetBtns.forEach((btn, index) => {
      btn.addEventListener('click', () => {
        if (index === 0) {
          workTimer[0, 1] = [timerRecord[0], timerRecord[1]]
        } else {
          workTimer[2, 3] = [timerRecord[2], timerRecord[3]]
        }
        console.log(timerRecord)
      })
    })
  </script>
</body>
</html>